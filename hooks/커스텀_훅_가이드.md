# ğŸª Supabase í†µí•© ì»¤ìŠ¤í…€ í›… ê°€ì´ë“œ

> **ì™„ì „í•œ Supabase í†µí•©ì„ ìœ„í•œ React ì»¤ìŠ¤í…€ í›…**  
> API ìš”ì²­, ë¡œë”© ìƒíƒœ ê´€ë¦¬, ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìë™í™”í•˜ì—¬ ê°œë°œ ì†ë„ë¥¼ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.

ì´ ê°€ì´ë“œëŠ” Supabaseì™€ ì™„ë²½í•˜ê²Œ í†µí•©ëœ ì»¤ìŠ¤í…€ í›…ë“¤ì˜ ì‚¬ìš©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤. `config/supabase.js`ì˜ API í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ë™í•˜ì—¬ ì¸ì¦, ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…, ì‹¤ì‹œê°„ ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ”„ useLoading ì»¤ìŠ¤í…€ í›…

## ì£¼ìš” ê¸°ëŠ¥ ë° ì„¤ëª…

useLoading í›…ì€ **Supabase API í˜¸ì¶œì„ í¬í•¨í•œ ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…(Promise)**ì„ ì‹¤í–‰í•˜ë©° ë¡œë”© ìƒíƒœë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤. Supabaseì˜ ì¸ì¦, ë°ì´í„°ë² ì´ìŠ¤, ìŠ¤í† ë¦¬ì§€ ì‘ì—…ê³¼ ì™„ë²½í•˜ê²Œ ì—°ë™ë˜ì–´ ë¹„ë™ê¸° ì‘ì—…ì˜ ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ë¡œë”© ìƒíƒœë¥¼ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•˜ë©°, UIì™€ ë¡œì§ì„ ë¶„ë¦¬í•´ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ê³¼ ê°€ë…ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

- **Supabase Auth**: `auth.signIn()`, `auth.signUp()` ë“± ì¸ì¦ ì‘ì—…
- **Supabase Database**: `db.from('users').select()` ë“± ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
- **Supabase Storage**: `storage.upload()` ë“± íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
- **API í˜¸ì¶œ**: `apiClient.get()` ë“±ì˜ ë¹„ë™ê¸° ìš”ì²­ ì²˜ë¦¬
- **ë³µì¡í•œ ë°ì´í„° ì²˜ë¦¬**: ë°ì´í„° í•„í„°ë§, ì •ë ¬, ì—°ì‚° ì²˜ë¦¬ ë“±

### ì¥ì 

- ì¬ì‚¬ìš©ì„±: ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ ë¡œë”© ê´€ë¦¬ ë¡œì§ì„ ê³µìœ  ê°€ëŠ¥.

- ë‹¨ìˆœí™”: try/catch + ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•œ ì¤„ë¡œ ê°„ê²°í•˜ê²Œ ì²˜ë¦¬.

- UI ë¶„ë¦¬: ë¹„ë™ê¸° ì‘ì—…ê³¼ UI ë Œë”ë§ì„ ëª…í™•íˆ ë¶„ë¦¬í•´ êµ¬ì¡°ì  ì„¤ê³„ ê°€ëŠ¥.

- í…ŒìŠ¤íŠ¸ ìš©ì´ì„±: ë…ë¦½ì ì¸ í›…ìœ¼ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±ì— ìœ ë¦¬.

### ì£¼ì˜ì‚¬í•­

- ì—ëŸ¬ ì²˜ë¦¬ í•„ìˆ˜: startLoadingì€ ì—ëŸ¬ë¥¼ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë˜ì§€ë¯€ë¡œ, í˜¸ì¶œë¶€ì—ì„œ try-catchë¡œ ì²˜ë¦¬í•´ì•¼ í•¨.

- useCallback ìµœì í™”: startLoadingì€ useCallbackìœ¼ë¡œ ë©”ëª¨ì´ì œì´ì…˜ë˜ì–´ ìˆì–´ ì˜ì¡´ì„± ê´€ë¦¬ ì£¼ì˜.

### TIP

- LoadingSpinner ì»´í¬ë„ŒíŠ¸ì™€ ê²°í•©í•˜ë©´ ë¹ ë¥´ê²Œ UX ê°œì„  ê°€ëŠ¥.

- ì—¬ëŸ¬ API ìš”ì²­ì„ ë³‘ë ¬ ë˜ëŠ” ìˆœì°¨ ì²˜ë¦¬í•  ë•Œë„ startLoadingìœ¼ë¡œ ê°ì‹¸ ì‚¬ìš© ê°€ëŠ¥.

- ë¡œë”© ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ ë¹„í™œì„±í™”, ìŠ¤ì¼ˆë ˆí†¤ UI ë“±ì„ ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥.

- íŒ€ì›ë“¤ì—ê²Œ useLoading ì‚¬ìš©ì„ ê°€ì´ë“œí•˜ë©´ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ ì œê³µ ê°€ëŠ¥.

## ì˜ˆì‹œ ì½”ë“œ

### ğŸ” Supabase Authì™€ í•¨ê»˜ ì‚¬ìš©
```jsx
import React, { useState } from 'react';
import useLoading from '../hooks/useLoading';
import { auth } from '../config/supabase';
import LoadingSpinner from '../components/common/LoadingSpinner';

const LoginForm = () => {
  const [isLoading, startLoading] = useLoading();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [user, setUser] = useState(null);

  const handleSignIn = async () => {
    try {
      // Supabase Auth ë¡œê·¸ì¸ì„ startLoadingìœ¼ë¡œ ê°ì‹¸ì„œ ë¡œë”© ìƒíƒœ ìë™ ê´€ë¦¬
      const data = await startLoading(auth.signIn(email, password));
      setUser(data.user);
      console.log('ë¡œê·¸ì¸ ì„±ê³µ:', data.user.email);
    } catch (error) {
      console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error.message);
      alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`);
    }
  };

  const handleSignUp = async () => {
    try {
      // íšŒì›ê°€ì…ë„ ë™ì¼í•˜ê²Œ ë¡œë”© ìƒíƒœ ê´€ë¦¬
      const data = await startLoading(auth.signUp(email, password, {
        data: { full_name: 'ìƒˆ ì‚¬ìš©ì' }
      }));
      console.log('íšŒì›ê°€ì… ì„±ê³µ:', data.user?.email);
      alert('íšŒì›ê°€ì… ì„±ê³µ! ì´ë©”ì¼ ì¸ì¦ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    } catch (error) {
      console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error.message);
      alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${error.message}`);
    }
  };

  if (user) {
    return (
      <div>
        <h2>í™˜ì˜í•©ë‹ˆë‹¤, {user.email}!</h2>
        <button onClick={() => startLoading(auth.signOut()).then(() => setUser(null))}>
          {isLoading ? 'ë¡œê·¸ì•„ì›ƒ ì¤‘...' : 'ë¡œê·¸ì•„ì›ƒ'}
        </button>
      </div>
    );
  }

  return (
    <div>
      <h2>ë¡œê·¸ì¸</h2>
      <input
        type="email"
        placeholder="ì´ë©”ì¼"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        disabled={isLoading}
      />
      <input
        type="password"
        placeholder="ë¹„ë°€ë²ˆí˜¸"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        disabled={isLoading}
      />
      <div>
        <button onClick={handleSignIn} disabled={isLoading}>
          {isLoading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
        </button>
        <button onClick={handleSignUp} disabled={isLoading}>
          {isLoading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…'}
        </button>
      </div>
      {isLoading && <LoadingSpinner message="ì²˜ë¦¬ ì¤‘..." />}
    </div>
  );
};

export default LoginForm;
```

### ğŸ—ƒï¸ Supabase Databaseì™€ í•¨ê»˜ ì‚¬ìš©
```jsx
import React, { useState, useEffect } from 'react';
import useLoading from '../hooks/useLoading';
import { db } from '../config/supabase';

const UserProfile = ({ userId }) => {
  const [isLoading, startLoading] = useLoading();
  const [profile, setProfile] = useState(null);
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState({ username: '', full_name: '' });

  // í”„ë¡œí•„ ì¡°íšŒ
  const fetchProfile = async () => {
    try {
      const data = await startLoading(
        db.from('profiles').select('*').eq('id', userId).single()
      );
      setProfile(data);
      setFormData({ username: data.username || '', full_name: data.full_name || '' });
    } catch (error) {
      console.error('í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨:', error.message);
    }
  };

  // í”„ë¡œí•„ ì—…ë°ì´íŠ¸
  const updateProfile = async () => {
    try {
      const updatedData = await startLoading(
        db.from('profiles')
          .update(formData)
          .eq('id', userId)
          .select()
          .single()
      );
      setProfile(updatedData);
      setIsEditing(false);
      alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } catch (error) {
      console.error('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error.message);
      alert(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`);
    }
  };

  useEffect(() => {
    if (userId) fetchProfile();
  }, [userId]);

  if (isLoading && !profile) {
    return <div>í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  return (
    <div>
      <h2>ì‚¬ìš©ì í”„ë¡œí•„</h2>
      {isEditing ? (
        <div>
          <input
            placeholder="ì‚¬ìš©ìëª…"
            value={formData.username}
            onChange={(e) => setFormData({...formData, username: e.target.value})}
            disabled={isLoading}
          />
          <input
            placeholder="ì „ì²´ ì´ë¦„"
            value={formData.full_name}
            onChange={(e) => setFormData({...formData, full_name: e.target.value})}
            disabled={isLoading}
          />
          <button onClick={updateProfile} disabled={isLoading}>
            {isLoading ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
          </button>
          <button onClick={() => setIsEditing(false)} disabled={isLoading}>
            ì·¨ì†Œ
          </button>
        </div>
      ) : (
        <div>
          <p>ì‚¬ìš©ìëª…: {profile?.username || 'ë¯¸ì„¤ì •'}</p>
          <p>ì „ì²´ ì´ë¦„: {profile?.full_name || 'ë¯¸ì„¤ì •'}</p>
          <button onClick={() => setIsEditing(true)} disabled={isLoading}>
            ìˆ˜ì •
          </button>
          <button onClick={fetchProfile} disabled={isLoading}>
            {isLoading ? 'ìƒˆë¡œê³ ì¹¨ ì¤‘...' : 'ìƒˆë¡œê³ ì¹¨'}
          </button>
        </div>
      )}
    </div>
  );
};

export default UserProfile;
```

### ğŸ“¦ Supabase Storageì™€ í•¨ê»˜ ì‚¬ìš©
```jsx
import React, { useState } from 'react';
import useLoading from '../hooks/useLoading';
import { storage } from '../config/supabase';

const FileUploader = ({ userId }) => {
  const [isLoading, startLoading] = useLoading();
  const [uploadedUrl, setUploadedUrl] = useState('');

  const handleFileUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    try {
      const fileName = `${userId}/${Date.now()}-${file.name}`;
      
      // íŒŒì¼ ì—…ë¡œë“œ
      const uploadData = await startLoading(
        storage.upload('avatars', fileName, file)
      );
      
      // ê³µê°œ URL ê°€ì ¸ì˜¤ê¸°
      const publicUrl = storage.getPublicUrl('avatars', uploadData.path);
      setUploadedUrl(publicUrl);
      
      alert('íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ!');
    } catch (error) {
      console.error('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:', error.message);
      alert(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
    }
  };

  return (
    <div>
      <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>
      <input 
        type="file" 
        onChange={handleFileUpload}
        disabled={isLoading}
        accept="image/*"
      />
      {isLoading && <p>íŒŒì¼ ì—…ë¡œë“œ ì¤‘...</p>}
      {uploadedUrl && (
        <div>
          <p>ì—…ë¡œë“œ ì™„ë£Œ!</p>
          <img src={uploadedUrl} alt="ì—…ë¡œë“œëœ ì´ë¯¸ì§€" style={{maxWidth: '200px'}} />
        </div>
      )}
    </div>
  );
};

export default FileUploader;
```

---

---

## ğŸ“¡ useApi ì»¤ìŠ¤í…€ í›…

## ì£¼ìš” ê¸°ëŠ¥ ë° ì„¤ëª…

useApiëŠ” **Supabase API í´ë¼ì´ì–¸íŠ¸**ì™€ ì™„ë²½í•˜ê²Œ í†µí•©ëœ ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ, ìë™ ìš”ì²­/ì‘ë‹µ ê´€ë¦¬, ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬, ìˆ˜ë™ ì¬ìš”ì²­(refetch) ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. `config/api.js`ì˜ API í´ë¼ì´ì–¸íŠ¸ë¥¼ í™œìš©í•˜ì—¬ Supabase ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

**ìë™ Supabase ì¿¼ë¦¬ ì‹¤í–‰:**

- ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë˜ë©´ Supabase í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ë°ì´í„° ì¡°íšŒ
- í…Œì´ë¸”ëª… ë˜ëŠ” ì¿¼ë¦¬ ì˜µì…˜ì´ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ìš”ì²­
- RLS(Row Level Security) ì •ì±… ìë™ ì ìš©

**ìƒíƒœ ê´€ë¦¬:**

- data: ì„±ê³µ ì‹œ ë°›ì€ ì‘ë‹µ ë°ì´í„°.

- loading: ìš”ì²­ ì¤‘ true.

- error: ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ê°ì²´ ì €ì¥.

**ì¬ìš”ì²­ ê¸°ëŠ¥:**

- refetch() í•¨ìˆ˜ë¥¼ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ API ìš”ì²­ì„ ë‹¤ì‹œ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ.

- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€

- ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ í›„ì—ë„ setStateê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ useRefë¡œ ë§ˆìš´íŠ¸ ìƒíƒœ ì¶”ì .

### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

- **ì‚¬ìš©ì í”„ë¡œí•„**: ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ ìë™ ë¡œë“œ
- **ë°ì´í„° ëª©ë¡**: ê²Œì‹œê¸€, ìƒí’ˆ ë“±ì˜ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€
- **ì‹¤ì‹œê°„ ê°±ì‹ **: refetchë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
- **ê¶Œí•œ ê¸°ë°˜ ë°ì´í„°**: RLS ì •ì±…ì— ë”°ë¥¸ ì‚¬ìš©ìë³„ ë°ì´í„° ì¡°íšŒ

### ì¥ì 

- ìë™í™”: ë§ˆìš´íŠ¸ ì‹œ ìë™ ìš”ì²­, ìƒíƒœ ìë™ ê´€ë¦¬ë¡œ ê°œë°œ ì†ë„ í–¥ìƒ.

- ì¬ì‚¬ìš©ì„±: ì—¬ëŸ¬ API ìš”ì²­ ì»´í¬ë„ŒíŠ¸ì— ë™ì¼í•œ í›… ì¬ì‚¬ìš© ê°€ëŠ¥.

- ê°„ê²°ì„±: ë¡œë”©/ì—ëŸ¬/ë°ì´í„° ìƒíƒœë¥¼ í›… ë‚´ë¶€ì—ì„œ ì¼ê´„ ì²˜ë¦¬.

- ì•ˆì •ì„±: ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ì—ˆì„ ë•Œ setState ë°©ì§€ ì²˜ë¦¬ í¬í•¨.

### ì£¼ì˜ì‚¬í•­

- **ì¡°íšŒ ì „ìš©**: í˜„ì¬ëŠ” SELECT ì¿¼ë¦¬ì— ìµœì í™”ë¨. INSERT/UPDATE/DELETEëŠ” ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© ê¶Œì¥
- **ì˜ì¡´ì„± ê´€ë¦¬**: ì¿¼ë¦¬ ì˜µì…˜ì´ ê°ì²´ì¼ ê²½ìš° ì°¸ì¡°ê°€ ë³€ê²½ë˜ì–´ ì˜ë„ì¹˜ ì•Šì€ ì¬ì‹¤í–‰ ë°œìƒ ê°€ëŠ¥
- **RLS ê³ ë ¤**: Row Level Security ì •ì±…ì— ë”°ë¼ ë°ì´í„° ì ‘ê·¼ì´ ì œí•œë  ìˆ˜ ìˆìŒ
- **ì—ëŸ¬ ì²˜ë¦¬**: Supabase ì—ëŸ¬ëŠ” UIì—ì„œ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì²˜ë¦¬ (í•œêµ­ì–´ ë©”ì‹œì§€ ìë™ ë³€í™˜)

### TIP

- **ì‹¤ì‹œê°„ ì—°ë™**: Supabase Realtimeê³¼ ê²°í•©í•˜ì—¬ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ê°±ì‹ 
- **ìºì‹± ì „ëµ**: ì¤‘ë³µ ìš”ì²­ ë°©ì§€ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ìºì‹± ë¡œì§ ë‚´ì¥
- **ì¸ì¦ ì—°ë™**: ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ìë™ ë°ì´í„° í•„í„°ë§
- **ì—ëŸ¬ ë³µêµ¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ìë™ ì¬ì‹œë„ (config/api.jsì˜ ì¬ì‹œë„ ë¡œì§ í™œìš©)

### ğŸš€ Supabase ì‹¤ì‹œê°„ ì—°ë™ ì˜ˆì‹œ
```jsx
import React, { useEffect } from 'react';
import useApi from '../hooks/useApi';
import { realtime } from '../config/supabase';

const RealtimeUserList = () => {
  const { data: users, loading, error, refetch } = useApi('/users');

  useEffect(() => {
    // Supabase Realtimeìœ¼ë¡œ ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë…
    const subscription = realtime.subscribe(
      'users',
      (payload) => {
        console.log('ì‚¬ìš©ì ë°ì´í„° ë³€ê²½:', payload);
        refetch(); // ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
      }
    );

    return () => {
      realtime.unsubscribe(subscription);
    };
  }, [refetch]);

  if (loading) return <div>ì‚¬ìš©ì ëª©ë¡ ë¡œë”© ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬: {error}</div>;

  return (
    <div>
      <h2>ì‹¤ì‹œê°„ ì‚¬ìš©ì ëª©ë¡</h2>
      <button onClick={refetch}>ìƒˆë¡œê³ ì¹¨</button>
      <ul>
        {users?.map(user => (
          <li key={user.id}>
            {user.full_name} ({user.email})
          </li>
        ))}
      </ul>
    </div>
  );
};

export default RealtimeUserList;
```

---

## ğŸ¯ **í†µí•© ì‚¬ìš© íŒ¨í„´**

### ì™„ì „í•œ Supabase CRUD ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ
```jsx
import React, { useState } from 'react';
import useApi from '../hooks/useApi';
import useLoading from '../hooks/useLoading';
import { db, auth } from '../config/supabase';

const UserManager = () => {
  const { data: users, loading: listLoading, refetch } = useApi('/users');
  const [isLoading, startLoading] = useLoading();
  const [newUser, setNewUser] = useState({ name: '', email: '' });

  // ìƒˆ ì‚¬ìš©ì ìƒì„±
  const createUser = async () => {
    try {
      await startLoading(
        db.from('profiles').insert({
          username: newUser.name,
          full_name: newUser.name,
          // auth.uid()ë¡œ í˜„ì¬ ì‚¬ìš©ì ID ìë™ ì„¤ì •
        })
      );
      setNewUser({ name: '', email: '' });
      refetch(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      alert('ì‚¬ìš©ì ìƒì„± ì™„ë£Œ!');
    } catch (error) {
      alert(`ìƒì„± ì‹¤íŒ¨: ${error.message}`);
    }
  };

  // ì‚¬ìš©ì ì‚­ì œ
  const deleteUser = async (userId) => {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
      await startLoading(
        db.from('profiles').delete().eq('id', userId)
      );
      refetch(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      alert('ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ!');
    } catch (error) {
      alert(`ì‚­ì œ ì‹¤íŒ¨: ${error.message}`);
    }
  };

  const loading = listLoading || isLoading;

  return (
    <div>
      <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>
      
      {/* ìƒˆ ì‚¬ìš©ì ìƒì„± í¼ */}
      <div style={{ marginBottom: '20px', padding: '20px', border: '1px solid #ddd' }}>
        <h3>ìƒˆ ì‚¬ìš©ì ì¶”ê°€</h3>
        <input
          placeholder="ì´ë¦„"
          value={newUser.name}
          onChange={(e) => setNewUser({...newUser, name: e.target.value})}
          disabled={loading}
        />
        <button onClick={createUser} disabled={loading || !newUser.name}>
          {isLoading ? 'ìƒì„± ì¤‘...' : 'ì‚¬ìš©ì ì¶”ê°€'}
        </button>
      </div>

      {/* ì‚¬ìš©ì ëª©ë¡ */}
      <div>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <h3>ì‚¬ìš©ì ëª©ë¡</h3>
          <button onClick={refetch} disabled={loading}>
            {listLoading ? 'ë¡œë”© ì¤‘...' : 'ìƒˆë¡œê³ ì¹¨'}
          </button>
        </div>
        
        {listLoading && !users ? (
          <div>ì‚¬ìš©ì ëª©ë¡ ë¡œë”© ì¤‘...</div>
        ) : users?.length === 0 ? (
          <div>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        ) : (
          <ul style={{ listStyle: 'none', padding: 0 }}>
            {users?.map(user => (
              <li key={user.id} style={{ 
                padding: '10px', 
                margin: '5px 0', 
                border: '1px solid #eee',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div>
                  <strong>{user.full_name || user.username}</strong>
                  <br />
                  <small style={{ color: '#666' }}>
                    ìƒì„±ì¼: {new Date(user.created_at).toLocaleDateString()}
                  </small>
                </div>
                <button 
                  onClick={() => deleteUser(user.id)}
                  disabled={loading}
                  style={{ color: 'red' }}
                >
                  {isLoading ? 'ì‚­ì œ ì¤‘...' : 'ì‚­ì œ'}
                </button>
              </li>
            ))}
          </ul>
        )}
      </div>
    </div>
  );
};

export default UserManager;
```

---

## ğŸ’¡ **ì„±ëŠ¥ ìµœì í™” íŒ**

### 1. ì ì ˆí•œ í›… ì„ íƒ
- **useApi**: ìë™ ë°ì´í„° ë¡œë”©ì´ í•„ìš”í•œ ê²½ìš° (ëª©ë¡, ìƒì„¸ í˜ì´ì§€)
- **useLoading**: ì‚¬ìš©ì ì•¡ì…˜ì— ë”°ë¥¸ ìˆ˜ë™ ì‹¤í–‰ (ìƒì„±, ìˆ˜ì •, ì‚­ì œ)

### 2. ë©”ëª¨ì´ì œì´ì…˜ í™œìš©
```jsx
const queryOptions = useMemo(() => ({
  select: 'id,name,email,created_at',
  order: 'created_at.desc',
  limit: 20
}), []);

const { data } = useApi('/users', queryOptions);
```

### 3. ì¡°ê±´ë¶€ ì‹¤í–‰
```jsx
// ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ë°ì´í„° ë¡œë“œ
const { data } = useApi(user ? '/profile' : null);
```

ì´ ê°€ì´ë“œë¥¼ í†µí•´ Supabaseì™€ ì™„ì „íˆ í†µí•©ëœ React ì• í”Œë¦¬ì¼€ì´ì…˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸš€
